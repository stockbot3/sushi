<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>Sushi - Live Sports Commentary</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script>window.react = window.React;</script>
  <script src="https://unpkg.com/lucide-react@0.460.0/dist/umd/lucide-react.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
  <script>
    tailwind.config = {
      theme: {
        extend: {
          fontFamily: { sans: ['Inter', 'system-ui', 'sans-serif'] },
          colors: {
            dark: { 900: '#0a0a0f', 800: '#12121a', 700: '#1a1a25', 600: '#222230' }
          },
          animation: {
            'slide-up': 'slideUp 0.5s ease-out',
            'fade-in': 'fadeIn 0.3s ease-out',
            'bounce-subtle': 'bounceSubtle 2s infinite',
          },
          keyframes: {
            slideUp: { '0%': { transform: 'translateY(20px)', opacity: '0' }, '100%': { transform: 'translateY(0)', opacity: '1' } },
            fadeIn: { '0%': { opacity: '0' }, '100%': { opacity: '1' } },
            bounceSubtle: { '0%, 100%': { transform: 'translateY(0)' }, '50%': { transform: 'translateY(-4px)' } },
          }
        }
      }
    }
  </script>
  <style>
    * { -webkit-tap-highlight-color: transparent; }
    body { background: #0a0a0f; overflow-x: hidden; }
    .glass { background: rgba(255,255,255,0.03); backdrop-filter: blur(20px); border: 1px solid rgba(255,255,255,0.06); }
    .glass-bright { background: rgba(255,255,255,0.06); backdrop-filter: blur(20px); border: 1px solid rgba(255,255,255,0.1); }
    .text-gradient { background: linear-gradient(135deg, #FFB81C, #FF6B35); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
    .scoreboard-glow { box-shadow: 0 0 60px rgba(255,184,28,0.12), 0 0 100px rgba(255,184,28,0.04); }
    .card-hover { transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); }
    .card-hover:hover { transform: translateY(-2px); box-shadow: 0 12px 40px rgba(0,0,0,0.4); }
    .live-dot { animation: livePulse 1.5s ease-in-out infinite; }
    @keyframes livePulse { 0%, 100% { opacity: 1; transform: scale(1); } 50% { opacity: 0.5; transform: scale(1.5); } }
    .scroll-hidden::-webkit-scrollbar { display: none; }
    .scroll-hidden { -ms-overflow-style: none; scrollbar-width: none; }
    .possession-arrow { animation: possessionBounce 1s ease-in-out infinite; }
    @keyframes possessionBounce { 0%, 100% { transform: translateX(0); } 50% { transform: translateX(4px); } }
    .countdown-glow { box-shadow: 0 0 40px rgba(255,184,28,0.08); }
    .countdown-digit { font-variant-numeric: tabular-nums; }
    @keyframes tickPulse { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.04); } }
    .tick-pulse { animation: tickPulse 1s ease-in-out infinite; }
    @keyframes bubbleIn { 0% { opacity: 0; transform: translateY(8px) scale(0.97); } 100% { opacity: 1; transform: translateY(0) scale(1); } }
    .bubble-in { animation: bubbleIn 0.4s ease-out forwards; }
    .bubble-a { border-left: 3px solid var(--color-a, #ff6b35); }
    .bubble-b { border-left: 3px solid var(--color-b, #4a90d9); }
    @keyframes moodPulse { 0%, 100% { box-shadow: 0 0 0 0 rgba(255,184,28,0.3); } 50% { box-shadow: 0 0 20px 4px rgba(255,184,28,0.15); } }
    .mood-electric { animation: moodPulse 1.5s ease-in-out infinite; }
    .confidence-bar { transition: width 0.8s cubic-bezier(0.4, 0, 0.2, 1); }

    .stream-overlay {
      position: fixed; inset: 0; z-index: 9999;
      background: #050508;
      display: flex; flex-direction: column;
      cursor: pointer; overflow: hidden;
    }
    .stream-overlay * { cursor: pointer; }
    .stream-scanline {
      position: absolute; inset: 0; pointer-events: none; z-index: 10;
      background: repeating-linear-gradient(0deg, transparent, transparent 2px, rgba(255,255,255,0.006) 2px, rgba(255,255,255,0.006) 4px);
    }
    .stream-hud {
      flex-shrink: 0; z-index: 5;
      background: linear-gradient(180deg, rgba(10,10,15,0.98) 0%, rgba(10,10,15,0.92) 100%);
      border-bottom: 1px solid rgba(255,255,255,0.06);
    }
    .stream-hud-top { display: flex; align-items: center; justify-content: space-between; padding: 10px 16px; }
    .stream-hud-scores { display: flex; align-items: center; gap: 0; }
    .stream-hud-team { display: flex; align-items: center; gap: 8px; padding: 4px 12px; }
    .stream-hud-team-away { border-radius: 8px 0 0 8px; background: rgba(255,255,255,0.04); }
    .stream-hud-team-home { border-radius: 0 8px 8px 0; background: rgba(255,255,255,0.04); }
    .stream-hud-abbr { font-size: 13px; font-weight: 800; letter-spacing: 1px; }
    .stream-hud-pts { font-size: 28px; font-weight: 900; line-height: 1; min-width: 28px; text-align: center; }
    .stream-hud-sep { font-size: 20px; color: rgba(255,255,255,0.12); padding: 0 6px; font-weight: 200; }
    .stream-hud-info { display: flex; align-items: center; gap: 8px; }
    .stream-hud-clock { font-size: 13px; font-weight: 700; color: rgba(255,255,255,0.5); font-variant-numeric: tabular-nums; }
    .stream-hud-live {
      display: flex; align-items: center; gap: 4px;
      background: rgba(239,68,68,0.15); border: 1px solid rgba(239,68,68,0.3);
      padding: 2px 8px; border-radius: 6px;
      font-size: 9px; font-weight: 800; color: #ef4444; letter-spacing: 1px;
    }
    .stream-hud-live-dot { width: 5px; height: 5px; border-radius: 50%; background: #ef4444; animation: livePulse 1.5s ease-in-out infinite; }
    .stream-hud-hint { font-size: 8px; color: rgba(255,255,255,0.12); letter-spacing: 1px; text-transform: uppercase; }
    .stream-play-ticker {
      padding: 8px 16px 10px;
      border-top: 1px solid rgba(255,184,28,0.08);
      background: linear-gradient(135deg, rgba(255,184,28,0.04), rgba(255,107,53,0.02));
    }
    .stream-play-ticker.fresh { animation: tickerFlash 0.6s ease-out; }
    @keyframes tickerFlash {
      0% { background: linear-gradient(135deg, rgba(255,184,28,0.15), rgba(255,107,53,0.08)); }
      100% { background: linear-gradient(135deg, rgba(255,184,28,0.04), rgba(255,107,53,0.02)); }
    }
    .stream-ticker-top { display: flex; align-items: center; gap: 6px; margin-bottom: 4px; }
    .stream-ticker-dot { width: 5px; height: 5px; border-radius: 50%; background: #FFB81C; animation: livePulse 1s ease-in-out infinite; }
    .stream-ticker-label { font-size: 8px; font-weight: 800; color: #FFB81C; letter-spacing: 1.5px; text-transform: uppercase; }
    .stream-ticker-type { font-size: 9px; font-weight: 700; color: rgba(255,255,255,0.3); text-transform: uppercase; letter-spacing: 0.5px; }
    .stream-ticker-mood {
      font-size: 8px; font-weight: 800; letter-spacing: 0.5px;
      padding: 1px 6px; border-radius: 4px; margin-left: auto;
    }
    .stream-ticker-desc { font-size: 13px; font-weight: 500; color: rgba(255,255,255,0.75); line-height: 1.4; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; }
    .stream-chat {
      flex: 1; overflow-y: auto; z-index: 2;
      padding: 16px 16px 20px;
      display: flex; flex-direction: column; justify-content: flex-end;
      background: radial-gradient(ellipse at 50% 80%, rgba(255,184,28,0.03) 0%, transparent 70%);
      -ms-overflow-style: none; scrollbar-width: none;
    }
    .stream-chat::-webkit-scrollbar { display: none; }
    .stream-bubble { padding: 10px 14px; border-radius: 12px; margin-bottom: 8px; max-width: 85%; animation: bubbleIn 0.4s ease-out forwards; }
    .stream-bubble-a { background: linear-gradient(135deg, rgba(255,107,53,0.1), rgba(255,107,53,0.03)); border-left: 3px solid var(--stream-color-a, #ff6b35); align-self: flex-start; }
    .stream-bubble-b { background: linear-gradient(135deg, rgba(74,144,217,0.1), rgba(74,144,217,0.03)); border-left: 3px solid var(--stream-color-b, #4a90d9); align-self: flex-end; }
    .stream-speaker { font-size: 10px; font-weight: 800; margin-bottom: 3px; letter-spacing: 0.5px; }
    .stream-text { font-size: 14px; line-height: 1.5; color: rgba(255,255,255,0.88); }
    .stream-powered { text-align: center; padding-top: 16px; font-size: 8px; color: rgba(255,255,255,0.08); letter-spacing: 2px; text-transform: uppercase; }
    @media (orientation: landscape) {
      .stream-hud-top { padding: 8px 20px; }
      .stream-play-ticker { padding: 6px 20px 8px; }
      .stream-chat { padding: 12px 20px 16px; }
      .stream-bubble { max-width: 65%; }
      .stream-text { font-size: 15px; }
      .stream-hud-pts { font-size: 32px; }
    }
    @media (min-width: 768px) {
      .stream-hud-top { padding: 12px 32px; }
      .stream-play-ticker { padding: 8px 32px 10px; }
      .stream-chat { padding: 20px 32px 24px; }
      .stream-bubble { max-width: 55%; }
      .stream-text { font-size: 16px; }
      .stream-hud-pts { font-size: 36px; }
      .stream-ticker-desc { font-size: 14px; }
    }

    /* Sport icons */
    .sport-icon { font-size: 24px; }
  </style>
</head>
<body class="font-sans text-white min-h-screen">
  <div id="root"></div>
  <script type="text/babel">
    const { useState, useEffect, useCallback, useRef } = React;

    const {
      Trophy, BarChart3, List, TrendingUp, Newspaper,
      Tv, MapPin, Scale, Target, Percent, Zap, Crown,
      GitCompare, Users, HeartPulse, CheckCircle, Star,
      DollarSign, ArrowUpDown, GitBranch, ChevronUp,
      ChevronDown, MoveRight, Play, AlertTriangle,
      CircleDot, Shield, CalendarOff, WifiOff, RefreshCw,
      Loader2, Clock, ExternalLink, Radio, Timer, Hourglass,
      MessageSquare, Mic, Flame, Volume2, Gauge, Maximize2,
      ArrowLeft
    } = LucideReact;

    // ─── SPORT ICONS ───
    const SPORT_ICONS = {
      football: '\uD83C\uDFC8',
      basketball: '\uD83C\uDFC0',
      baseball: '\u26BE',
      hockey: '\uD83C\uDFD2',
      soccer: '\u26BD',
    };

    // ─── HASH ROUTER ───
    function useHashRoute() {
      const [route, setRoute] = useState(window.location.hash || '#/');
      useEffect(() => {
        const handler = () => setRoute(window.location.hash || '#/');
        window.addEventListener('hashchange', handler);
        return () => window.removeEventListener('hashchange', handler);
      }, []);
      return route;
    }

    function navigate(hash) {
      window.location.hash = hash;
    }

    // ─── NAV TABS ───
    const tabDefs = [
      { id: 'scores', label: 'Scores', Icon: Trophy },
      { id: 'commentary', label: 'AI Talk', Icon: Mic },
      { id: 'stats', label: 'Stats', Icon: BarChart3 },
      { id: 'plays', label: 'Plays', Icon: List },
      { id: 'odds', label: 'Odds', Icon: TrendingUp },
      { id: 'news', label: 'News', Icon: Newspaper },
    ];

    function getVisibleTabs(sport) {
      if (sport && sport !== 'football') {
        return tabDefs.filter(t => t.id !== 'plays');
      }
      return tabDefs;
    }

    function getPeriodLabel(sport, period) {
      switch (sport) {
        case 'basketball': return `Q${period}`;
        case 'baseball': return period <= 9 ? `${period}${['st','nd','rd'][period-1] || 'th'}` : `${period}th`;
        case 'hockey': return `P${period}`;
        case 'soccer': return period === 1 ? '1H' : '2H';
        default: return `Q${period}`;
      }
    }

    // ─── TEAM LOGO ───
    function TeamLogo({ src, alt, size = 'w-10 h-10' }) {
      const [err, setErr] = useState(false);
      if (!src || err) return (
        <div className={`${size} rounded-full bg-white/10 flex items-center justify-center`}>
          <Shield size={20} color="#666" />
        </div>
      );
      return <img src={src} alt={alt} className={`${size} object-contain`} onError={() => setErr(true)} />;
    }

    // ─── SCOREBOARD ───
    function Scoreboard({ game, sport }) {
      if (!game || game.error) {
        return (
          <div className="scoreboard-glow glass rounded-2xl p-6 text-center animate-fade-in">
            <div className="flex justify-center mb-3"><CalendarOff size={32} color="#555" /></div>
            <div className="text-sm text-gray-400">No game data found</div>
            <div className="text-xs text-gray-600 mt-1">Check back closer to game time</div>
          </div>
        );
      }

      const isLive = game.status?.state === 'in';
      const isFinal = game.status?.state === 'post';
      const isPre = game.status?.state === 'pre';
      const homeColor = game.home?.color || '#333';
      const awayColor = game.away?.color || '#333';
      const homeWinning = game.home.score > game.away.score;
      const awayWinning = game.away.score > game.home.score;

      return (
        <div className="scoreboard-glow rounded-2xl overflow-hidden animate-fade-in">
          <div className="flex items-center justify-between px-4 py-2 bg-dark-700/80">
            <div className="flex items-center gap-2">
              {isLive && <span className="live-dot w-2 h-2 rounded-full bg-red-500 inline-block"></span>}
              <span className={`text-xs font-bold uppercase tracking-wider ${isLive ? 'text-red-400' : isFinal ? 'text-yellow-400' : 'text-gray-400'}`}>
                {game.status?.detail || 'Upcoming'}
              </span>
            </div>
            <span className="text-xs text-gray-500">{game.note || ''}</span>
          </div>

          <div className="relative p-5 sm:p-6">
            <div className="relative flex items-center justify-between gap-2">
              <div className="flex-1 text-center">
                <TeamLogo src={game.away.logo} alt={game.away.abbreviation} size="w-12 h-12 sm:w-14 sm:h-14 mx-auto" />
                <div className="text-xs sm:text-sm font-bold mt-1.5 uppercase tracking-wider" style={{color: awayColor}}>{game.away.abbreviation}</div>
                <div className="text-[10px] text-gray-500">{game.away.record}</div>
                {isLive && game.situation?.possessionText?.toLowerCase().includes(game.away.shortName?.toLowerCase()) && (
                  <div className="possession-arrow flex justify-center mt-1"><CircleDot size={12} color={awayColor} /></div>
                )}
              </div>

              <div className="flex items-center gap-3 sm:gap-6">
                <div className={`text-5xl sm:text-7xl font-black tabular-nums ${!isPre && awayWinning ? 'text-white' : !isPre ? 'text-gray-500' : 'text-gray-600'}`}>
                  {isPre ? '-' : game.away.score}
                </div>
                <div className="text-gray-600 text-lg font-light">:</div>
                <div className={`text-5xl sm:text-7xl font-black tabular-nums ${!isPre && homeWinning ? 'text-white' : !isPre ? 'text-gray-500' : 'text-gray-600'}`}>
                  {isPre ? '-' : game.home.score}
                </div>
              </div>

              <div className="flex-1 text-center">
                <TeamLogo src={game.home.logo} alt={game.home.abbreviation} size="w-12 h-12 sm:w-14 sm:h-14 mx-auto" />
                <div className="text-xs sm:text-sm font-bold mt-1.5 uppercase tracking-wider" style={{color: homeColor}}>{game.home.abbreviation}</div>
                <div className="text-[10px] text-gray-500">{game.home.record}</div>
                {isLive && game.situation?.possessionText?.toLowerCase().includes(game.home.shortName?.toLowerCase()) && (
                  <div className="possession-arrow flex justify-center mt-1"><CircleDot size={12} color={homeColor} /></div>
                )}
              </div>
            </div>

            {(isLive || isFinal) && (game.away.linescores?.length > 0 || game.home.linescores?.length > 0) && (
              <div className="mt-4 flex justify-center">
                <table className="text-[10px] text-gray-500">
                  <thead>
                    <tr>
                      <th className="px-2 py-0.5 text-left"></th>
                      {(game.away.linescores || game.home.linescores || []).map((_, i) => (
                        <th key={i} className="px-2 py-0.5 font-medium">{getPeriodLabel(sport, i + 1)}</th>
                      ))}
                      <th className="px-2 py-0.5 font-bold text-white">T</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr>
                      <td className="px-2 py-0.5 font-medium" style={{color: awayColor}}>{game.away.abbreviation}</td>
                      {(game.away.linescores || []).map((s, i) => <td key={i} className="px-2 py-0.5 text-center">{s}</td>)}
                      <td className="px-2 py-0.5 text-center font-bold text-white">{game.away.score}</td>
                    </tr>
                    <tr>
                      <td className="px-2 py-0.5 font-medium" style={{color: homeColor}}>{game.home.abbreviation}</td>
                      {(game.home.linescores || []).map((s, i) => <td key={i} className="px-2 py-0.5 text-center">{s}</td>)}
                      <td className="px-2 py-0.5 text-center font-bold text-white">{game.home.score}</td>
                    </tr>
                  </tbody>
                </table>
              </div>
            )}
          </div>

          {isLive && game.situation?.downDistanceText && (
            <div className="px-4 py-2 bg-dark-700/50 border-t border-white/5">
              <div className="flex items-center gap-2">
                <span className="text-yellow-400 text-xs font-bold">{game.situation.downDistanceText}</span>
                {game.situation.isRedZone && (
                  <span className="text-[9px] bg-red-500/20 text-red-400 px-1.5 py-0.5 rounded-full font-bold flex items-center gap-1">
                    <AlertTriangle size={9} /> RED ZONE
                  </span>
                )}
              </div>
            </div>
          )}
          {(isLive || isFinal) && game.situation?.lastPlay && (
            <div className="px-4 py-2.5 bg-dark-700/30 border-t border-white/5">
              <div className="flex items-start gap-2">
                <div className="mt-0.5 text-yellow-400"><Play size={10} /></div>
                <p className="text-xs text-gray-400 leading-relaxed">{game.situation.lastPlay}</p>
              </div>
            </div>
          )}

          <div className="flex border-t border-white/5">
            <div className="flex-1 py-2 text-center" style={{background: `linear-gradient(135deg, ${awayColor}cc, ${awayColor}88)`}}>
              <span className="text-xs sm:text-sm font-bold text-white/90">{game.away.name}</span>
            </div>
            <div className="flex-1 py-2 text-center" style={{background: `linear-gradient(135deg, ${homeColor}cc, ${homeColor}88)`}}>
              <span className="text-xs sm:text-sm font-bold text-white/90">{game.home.name}</span>
            </div>
          </div>
        </div>
      );
    }

    // ─── GAME INFO ───
    function GameInfo({ game }) {
      if (!game || game.error) return null;
      return (
        <div className="grid grid-cols-2 gap-3 animate-fade-in">
          <div className="glass rounded-xl p-4 text-center card-hover">
            <div className="flex justify-center mb-1.5 text-gray-400"><Tv size={22} /></div>
            <div className="text-xs text-gray-500 mb-0.5">Watch On</div>
            <div className="text-sm font-bold">{game.broadcast || 'TBD'}</div>
          </div>
          <div className="glass rounded-xl p-4 text-center card-hover">
            <div className="flex justify-center mb-1.5 text-gray-400"><MapPin size={22} /></div>
            <div className="text-xs text-gray-500 mb-0.5">Venue</div>
            <div className="text-sm font-bold">{game.venue?.name || 'TBD'}</div>
          </div>
          {game.odds?.spread && (
            <div className="glass rounded-xl p-4 text-center card-hover">
              <div className="flex justify-center mb-1.5 text-yellow-400"><Scale size={22} /></div>
              <div className="text-xs text-gray-500 mb-0.5">Spread</div>
              <div className="text-sm font-bold text-yellow-400">{game.odds.spread}</div>
            </div>
          )}
          {game.odds?.overUnder && (
            <div className="glass rounded-xl p-4 text-center card-hover">
              <div className="flex justify-center mb-1.5 text-orange-400"><Target size={22} /></div>
              <div className="text-xs text-gray-500 mb-0.5">Over/Under</div>
              <div className="text-sm font-bold text-gradient">{game.odds.overUnder}</div>
            </div>
          )}
        </div>
      );
    }

    // ─── COUNTDOWN TIMER ───
    function Countdown({ gameDate }) {
      const [timeLeft, setTimeLeft] = useState(null);
      useEffect(() => {
        if (!gameDate) return;
        const target = new Date(gameDate).getTime();
        function update() {
          const diff = target - Date.now();
          if (diff <= 0) { setTimeLeft(null); return; }
          setTimeLeft({
            days: Math.floor(diff / 86400000),
            hours: Math.floor((diff % 86400000) / 3600000),
            minutes: Math.floor((diff % 3600000) / 60000),
            seconds: Math.floor((diff % 60000) / 1000),
          });
        }
        update();
        const interval = setInterval(update, 1000);
        return () => clearInterval(interval);
      }, [gameDate]);
      if (!timeLeft) return null;
      const units = [
        { value: timeLeft.days, label: 'Days' },
        { value: timeLeft.hours, label: 'Hours' },
        { value: timeLeft.minutes, label: 'Mins' },
        { value: timeLeft.seconds, label: 'Secs' },
      ];
      const visibleUnits = timeLeft.days > 0 ? units : units.slice(1);
      return (
        <div className="countdown-glow glass rounded-2xl p-5 text-center animate-fade-in">
          <div className="flex items-center justify-center gap-2 mb-4">
            <Timer size={16} className="text-yellow-400 tick-pulse" />
            <span className="text-xs font-bold uppercase tracking-widest text-gray-400">Kickoff In</span>
          </div>
          <div className="flex items-center justify-center gap-3">
            {visibleUnits.map((unit, i) => (
              <React.Fragment key={unit.label}>
                {i > 0 && <span className="text-xl font-light text-gray-600 -mt-4">:</span>}
                <div className="flex flex-col items-center">
                  <div className="glass-bright rounded-xl w-16 h-16 sm:w-20 sm:h-20 flex items-center justify-center">
                    <span className="countdown-digit text-2xl sm:text-3xl font-black text-white">{String(unit.value).padStart(2, '0')}</span>
                  </div>
                  <span className="text-[10px] text-gray-500 mt-1.5 font-medium uppercase tracking-wider">{unit.label}</span>
                </div>
              </React.Fragment>
            ))}
          </div>
        </div>
      );
    }

    // ─── SCORES TAB ───
    function ScoresTab({ game, summary, sport }) {
      return (
        <div className="space-y-4 animate-slide-up">
          <Scoreboard game={game} sport={sport} />
          {game?.status?.state === 'pre' && game?.date && <Countdown gameDate={game.date} />}
          <GameInfo game={game} />
          {summary?.prediction?.home?.winPct && (
            <div className="glass rounded-xl p-4">
              <div className="flex items-center gap-2 mb-3 text-gray-500">
                <Percent size={14} />
                <h3 className="text-xs font-bold uppercase tracking-wider">ESPN Win Probability</h3>
              </div>
              <div className="flex items-center gap-3">
                <div className="text-center flex-1">
                  <div className="text-lg font-black" style={{color: game?.away?.color || '#fff'}}>{parseFloat(summary.prediction.away.winPct).toFixed(1)}%</div>
                  <div className="text-[10px] text-gray-500">{summary.prediction.away.name}</div>
                </div>
                <div className="flex-1 h-2 rounded-full bg-white/5 overflow-hidden">
                  <div className="h-full rounded-full transition-all duration-500" style={{
                    width: `${summary.prediction.away.winPct}%`, background: game?.away?.color || '#666'
                  }}></div>
                </div>
                <div className="text-center flex-1">
                  <div className="text-lg font-black" style={{color: game?.home?.color || '#fff'}}>{parseFloat(summary.prediction.home.winPct).toFixed(1)}%</div>
                  <div className="text-[10px] text-gray-500">{summary.prediction.home.name}</div>
                </div>
              </div>
            </div>
          )}
          {summary?.scoring?.length > 0 && (
            <div className="glass rounded-xl p-4">
              <div className="flex items-center gap-2 mb-3 text-gray-500">
                <Zap size={14} />
                <h3 className="text-xs font-bold uppercase tracking-wider">Scoring Plays</h3>
              </div>
              <div className="space-y-2">
                {summary.scoring.map((sp, i) => (
                  <div key={i} className="p-3 rounded-lg bg-white/[0.02]">
                    <div className="flex items-center justify-between mb-1">
                      <span className="text-xs font-bold text-yellow-400">{getPeriodLabel(sport, sp.period)} {sp.clock}</span>
                      <span className="text-xs text-gray-500">{sp.awayScore} - {sp.homeScore}</span>
                    </div>
                    <div className="text-xs text-gray-300">{sp.text}</div>
                  </div>
                ))}
              </div>
            </div>
          )}
          {summary?.leaders?.length > 0 && (
            <div className="glass rounded-xl p-4">
              <div className="flex items-center gap-2 mb-3 text-gray-500">
                <Crown size={14} />
                <h3 className="text-xs font-bold uppercase tracking-wider">Season Leaders</h3>
              </div>
              <div className="space-y-4">
                {summary.leaders.map((tl, ti) => (
                  <div key={ti}>
                    <div className="text-xs font-bold text-gray-400 mb-2">{tl.team}</div>
                    <div className="grid grid-cols-1 gap-2">
                      {tl.leaders.slice(0, 4).map((cat, ci) => (
                        <div key={ci}>
                          {cat.athletes.slice(0, 1).map((a, ai) => (
                            <div key={ai} className="flex items-center gap-3 p-2 rounded-lg bg-white/[0.02]">
                              {a.headshot ? (
                                <img src={a.headshot} className="w-8 h-8 rounded-full object-cover bg-white/10" onError={(e) => e.target.style.display='none'} />
                              ) : (
                                <div className="w-8 h-8 rounded-full bg-white/10 flex items-center justify-center text-xs">#{a.jersey}</div>
                              )}
                              <div className="flex-1 min-w-0">
                                <div className="text-xs font-bold text-white truncate">{a.name}</div>
                                <div className="text-[10px] text-gray-500">{cat.displayName}</div>
                              </div>
                              <div className="text-xs font-bold text-yellow-400">{a.stat}</div>
                            </div>
                          ))}
                        </div>
                      ))}
                    </div>
                  </div>
                ))}
              </div>
            </div>
          )}
        </div>
      );
    }

    // ─── STATS TAB ───
    function StatsTab({ summary, game }) {
      if (!summary?.teamStats?.length && !summary?.playerStats?.length) {
        return (
          <div className="glass rounded-xl p-8 text-center animate-slide-up">
            <div className="flex justify-center mb-3 text-gray-600"><BarChart3 size={32} /></div>
            <div className="text-sm text-gray-400">Stats will appear once the game begins</div>
          </div>
        );
      }
      return (
        <div className="space-y-4 animate-slide-up">
          {summary.teamStats.length === 2 && (
            <div className="glass rounded-xl p-4">
              <div className="flex items-center gap-2 mb-3 text-gray-500">
                <GitCompare size={14} />
                <h3 className="text-xs font-bold uppercase tracking-wider">Team Stats</h3>
              </div>
              <div className="space-y-3">
                {summary.teamStats[0].stats.map((stat, i) => {
                  const homeStat = summary.teamStats[1].stats[i];
                  if (!homeStat) return null;
                  return (
                    <div key={i} className="text-center">
                      <div className="flex items-center justify-between mb-1">
                        <span className="text-sm font-bold text-white w-16 text-left">{stat.displayValue}</span>
                        <span className="text-[10px] text-gray-500 uppercase flex-1 text-center">{stat.label || stat.name}</span>
                        <span className="text-sm font-bold text-white w-16 text-right">{homeStat.displayValue}</span>
                      </div>
                      <div className="h-1 rounded-full bg-white/5 overflow-hidden flex">
                        <div className="h-full rounded-l-full" style={{width: '50%', background: game?.away?.color || '#666', opacity: parseFloat(stat.displayValue) >= parseFloat(homeStat.displayValue) ? 1 : 0.4}}></div>
                        <div className="h-full rounded-r-full" style={{width: '50%', background: game?.home?.color || '#666', opacity: parseFloat(homeStat.displayValue) >= parseFloat(stat.displayValue) ? 1 : 0.4}}></div>
                      </div>
                    </div>
                  );
                })}
              </div>
            </div>
          )}
          {summary.playerStats.map((teamPlayers, ti) => (
            <div key={ti} className="glass rounded-xl p-4">
              <div className="flex items-center gap-2 mb-3 text-gray-500">
                <Users size={14} />
                <h3 className="text-xs font-bold uppercase tracking-wider">{teamPlayers.team}</h3>
              </div>
              {teamPlayers.categories.slice(0, 4).map((cat, ci) => (
                <div key={ci} className="mb-4 last:mb-0">
                  <div className="text-[10px] font-bold text-yellow-400/80 uppercase tracking-wider mb-2">{cat.name}</div>
                  <div className="overflow-x-auto scroll-hidden">
                    <table className="w-full text-[10px]">
                      <thead>
                        <tr className="text-gray-600">
                          <th className="text-left py-1 pr-2 font-medium">Player</th>
                          {cat.labels.map((l, li) => <th key={li} className="px-1.5 py-1 text-center font-medium">{l}</th>)}
                        </tr>
                      </thead>
                      <tbody>
                        {cat.athletes.slice(0, 5).map((a, ai) => (
                          <tr key={ai} className="border-t border-white/5">
                            <td className="py-1.5 pr-2 text-white font-medium whitespace-nowrap">{a.name} <span className="text-gray-600">#{a.jersey}</span></td>
                            {a.stats.map((s, si) => <td key={si} className="px-1.5 py-1.5 text-center text-gray-400">{s}</td>)}
                          </tr>
                        ))}
                      </tbody>
                    </table>
                  </div>
                </div>
              ))}
            </div>
          ))}
        </div>
      );
    }

    // ─── PLAYS TAB ───
    function PlaysTab({ summary, game }) {
      if (!summary?.drives?.length) {
        return (
          <div className="glass rounded-xl p-8 text-center animate-slide-up">
            <div className="flex justify-center mb-3 text-gray-600"><List size={32} /></div>
            <div className="text-sm text-gray-400">Play-by-play will appear once the game begins</div>
          </div>
        );
      }
      const [expandedDrive, setExpandedDrive] = useState(null);
      const drives = [...summary.drives].reverse();
      return (
        <div className="space-y-2 animate-slide-up">
          <div className="flex items-center justify-between px-1 mb-2">
            <div className="flex items-center gap-2 text-gray-500">
              <List size={14} />
              <h3 className="text-xs font-bold uppercase tracking-wider">Drive Summary</h3>
            </div>
            <span className="text-[10px] text-gray-600">{drives.length} drives</span>
          </div>
          {drives.map((drive, i) => {
            const isExpanded = expandedDrive === i;
            const isScoringDrive = drive.result?.toLowerCase().includes('touchdown') || drive.result?.toLowerCase().includes('field goal');
            return (
              <div key={i} className={`glass rounded-xl overflow-hidden card-hover ${isScoringDrive ? 'border-yellow-400/20' : ''}`}>
                <button onClick={() => setExpandedDrive(isExpanded ? null : i)} className="w-full p-3 text-left flex items-center gap-3">
                  <div className="flex-shrink-0">
                    {isScoringDrive ? <Zap size={18} className="text-yellow-400" /> : <MoveRight size={18} className="text-gray-600" />}
                  </div>
                  <div className="flex-1 min-w-0">
                    <div className="flex items-center gap-2">
                      <span className="text-xs font-bold text-white">{drive.team}</span>
                      <span className={`text-[9px] px-1.5 py-0.5 rounded-full font-bold ${isScoringDrive ? 'bg-yellow-400/20 text-yellow-400' : 'bg-white/5 text-gray-500'}`}>{drive.result}</span>
                    </div>
                    <div className="text-[10px] text-gray-500 mt-0.5">
                      {drive.plays} plays, {drive.yards} yds, {drive.timeOfPossession}
                      {drive.start?.quarter && ` \u2014 Q${drive.start.quarter} ${drive.start.clock}`}
                    </div>
                  </div>
                  {isExpanded ? <ChevronUp size={14} className="text-gray-600" /> : <ChevronDown size={14} className="text-gray-600" />}
                </button>
                {isExpanded && drive.playList?.length > 0 && (
                  <div className="border-t border-white/5 px-3 py-2 space-y-1.5 bg-white/[0.01] max-h-64 overflow-y-auto scroll-hidden">
                    {drive.playList.map((play, pi) => (
                      <div key={pi} className={`text-[10px] p-2 rounded ${play.scoringPlay ? 'bg-yellow-400/10 text-yellow-300' : 'text-gray-400'}`}>
                        <span className="text-gray-600 mr-1">{play.down && `${play.down}&${play.distance}`}</span>
                        {play.text}
                      </div>
                    ))}
                  </div>
                )}
              </div>
            );
          })}
        </div>
      );
    }

    // ─── ODDS TAB ───
    function OddsTab({ summary, game }) {
      const odds = summary?.odds || [];
      if (!odds.length && !game?.odds?.spread) {
        return (
          <div className="glass rounded-xl p-8 text-center animate-slide-up">
            <div className="flex justify-center mb-3 text-gray-600"><TrendingUp size={32} /></div>
            <div className="text-sm text-gray-400">Odds data is loading...</div>
          </div>
        );
      }
      const primaryOdds = odds[0] || {};
      return (
        <div className="space-y-4 animate-slide-up">
          <div className="glass rounded-xl p-4">
            <div className="flex items-center gap-2 mb-4">
              <TrendingUp size={14} className="text-gray-500" />
              <h3 className="text-xs font-bold text-gray-500 uppercase tracking-wider">Game Lines</h3>
              {(primaryOdds.provider || game?.odds?.provider) && (
                <span className="text-[9px] bg-white/5 text-gray-500 px-1.5 py-0.5 rounded-full">via {primaryOdds.provider || game.odds.provider}</span>
              )}
            </div>
            <div className="space-y-4">
              <div className="flex items-center justify-between p-3 rounded-lg bg-white/[0.02]">
                <div className="flex items-center gap-2 text-gray-400"><Scale size={14} /><span className="text-sm">Spread</span></div>
                <span className="text-sm font-bold text-yellow-400">{primaryOdds.spread || game?.odds?.spread || '\u2014'}</span>
              </div>
              {(primaryOdds.awayMoneyline || primaryOdds.homeMoneyline) && (
                <div className="p-3 rounded-lg bg-white/[0.02]">
                  <div className="flex items-center gap-2 mb-2 text-gray-400"><DollarSign size={14} /><span className="text-sm">Moneyline</span></div>
                  <div className="flex gap-2">
                    <div className="flex-1 text-center p-2 rounded-lg" style={{background: `${game?.away?.color || '#333'}33`}}>
                      <div className="text-[10px] text-white/70">{game?.away?.abbreviation}</div>
                      <div className="text-lg font-bold">{primaryOdds.awayMoneyline > 0 ? '+' : ''}{primaryOdds.awayMoneyline}</div>
                      {primaryOdds.awayFavorite && <div className="text-[8px] text-yellow-400 mt-0.5 flex items-center justify-center gap-0.5"><Star size={8} /> FAV</div>}
                    </div>
                    <div className="flex-1 text-center p-2 rounded-lg" style={{background: `${game?.home?.color || '#333'}33`}}>
                      <div className="text-[10px] text-white/70">{game?.home?.abbreviation}</div>
                      <div className="text-lg font-bold">{primaryOdds.homeMoneyline > 0 ? '+' : ''}{primaryOdds.homeMoneyline}</div>
                      {primaryOdds.homeFavorite && <div className="text-[8px] text-yellow-400 mt-0.5 flex items-center justify-center gap-0.5"><Star size={8} /> FAV</div>}
                    </div>
                  </div>
                </div>
              )}
              <div className="p-3 rounded-lg bg-white/[0.02]">
                <div className="flex items-center gap-2 mb-2 text-gray-400"><ArrowUpDown size={14} /><span className="text-sm">Over/Under</span></div>
                <div className="flex items-center justify-center gap-4">
                  {primaryOdds.overOdds && <div className="text-center"><div className="text-xs text-gray-500">Over</div><div className="text-sm font-bold text-green-400">{primaryOdds.overOdds}</div></div>}
                  <div className="text-3xl font-black text-gradient">{primaryOdds.overUnder || game?.odds?.overUnder || '\u2014'}</div>
                  {primaryOdds.underOdds && <div className="text-center"><div className="text-xs text-gray-500">Under</div><div className="text-sm font-bold text-red-400">{primaryOdds.underOdds}</div></div>}
                </div>
              </div>
              {(primaryOdds.awayOpenSpread || primaryOdds.awayOpenML) && (
                <div className="p-3 rounded-lg bg-white/[0.02]">
                  <div className="flex items-center gap-2 mb-2 text-gray-400"><GitBranch size={14} /><span className="text-sm">Line Movement</span></div>
                  <div className="grid grid-cols-2 gap-2 text-xs">
                    <div className="text-center">
                      <div className="text-gray-600 mb-1">Opening</div>
                      <div className="text-gray-400">Spread: {primaryOdds.awayOpenSpread || '\u2014'}</div>
                      <div className="text-gray-400">ML: {primaryOdds.awayOpenML || '\u2014'}</div>
                    </div>
                    <div className="text-center">
                      <div className="text-gray-600 mb-1">Current</div>
                      <div className="text-white font-medium">Spread: {primaryOdds.spread || '\u2014'}</div>
                      <div className="text-white font-medium">ML: {primaryOdds.awayMoneyline || '\u2014'}</div>
                    </div>
                  </div>
                </div>
              )}
            </div>
          </div>
          {summary?.injuries?.length > 0 && (
            <div className="glass rounded-xl p-4">
              <div className="flex items-center gap-2 mb-3 text-gray-500"><HeartPulse size={14} /><h3 className="text-xs font-bold uppercase tracking-wider">Injury Report</h3></div>
              {summary.injuries.map((team, ti) => (
                <div key={ti} className="mb-3 last:mb-0">
                  <div className="text-xs font-bold text-gray-400 mb-1.5">{team.team}</div>
                  {team.injuries.length === 0 ? (
                    <div className="text-[10px] text-gray-600 flex items-center gap-1"><CheckCircle size={10} className="text-green-400" /> No injuries reported</div>
                  ) : (
                    <div className="space-y-1">
                      {team.injuries.map((inj, ii) => (
                        <div key={ii} className="flex items-center justify-between text-[10px] p-1.5 rounded bg-white/[0.02]">
                          <span className="text-gray-300">{inj.name} <span className="text-gray-600">{inj.position}</span></span>
                          <span className={`font-bold ${inj.status === 'Out' || inj.status === 'Injured Reserve' ? 'text-red-400' : inj.status === 'Questionable' ? 'text-yellow-400' : 'text-gray-400'}`}>{inj.status}</span>
                        </div>
                      ))}
                    </div>
                  )}
                </div>
              ))}
            </div>
          )}
        </div>
      );
    }

    // ─── STREAM OVERLAY ───
    function StreamOverlay({ commentary: initialCommentary, game, onClose, sessionId, commentators }) {
      const awayColor = game?.away?.color || '#ff6b35';
      const homeColor = game?.home?.color || '#4a90d9';
      const awayAbbr = game?.away?.abbreviation || 'AWY';
      const homeAbbr = game?.home?.abbreviation || 'HME';
      const isLive = game?.status?.state === 'in';

      const [liveCommentary, setLiveCommentary] = useState(initialCommentary);
      const [playKey, setPlayKey] = useState(0);
      const lastPlayRef = useRef(initialCommentary?.play?.description || '');
      const chatEndRef = useRef(null);
      const pollRef = useRef(null);

      const moodColors = {
        electric: { bg: 'rgba(255,184,28,0.2)', color: '#FFB81C', label: 'ELECTRIC' },
        disaster: { bg: 'rgba(239,68,68,0.2)', color: '#ef4444', label: 'DISASTER' },
        momentum_shift: { bg: 'rgba(168,85,247,0.2)', color: '#a855f7', label: 'MOMENTUM' },
        big_play: { bg: 'rgba(34,197,94,0.2)', color: '#22c55e', label: 'BIG PLAY' },
        defensive_dominance: { bg: 'rgba(59,130,246,0.2)', color: '#3b82f6', label: 'D-WALL' },
        controversial: { bg: 'rgba(249,115,22,0.2)', color: '#f97316', label: 'FLAG?!' },
        stuffed: { bg: 'rgba(156,163,175,0.2)', color: '#9ca3af', label: 'STUFFED' },
        routine: { bg: 'rgba(107,114,128,0.2)', color: '#6b7280', label: 'ROUTINE' },
      };

      const apiBase = sessionId ? `/api/sessions/${sessionId}` : '/api';

      useEffect(() => {
        document.body.style.overflow = 'hidden';
        const fetchStream = async () => {
          try {
            const res = await fetch(`${apiBase}/commentary/latest`);
            const data = await res.json();
            if (data.turns?.length > 0) {
              const newDesc = data.play?.description || '';
              if (newDesc && newDesc !== lastPlayRef.current) {
                lastPlayRef.current = newDesc;
                setPlayKey(k => k + 1);
              }
              setLiveCommentary(data);
            }
          } catch (err) {}
        };
        fetchStream();
        pollRef.current = setInterval(fetchStream, isLive ? 10000 : 30000);
        return () => { document.body.style.overflow = ''; clearInterval(pollRef.current); };
      }, [isLive, apiBase]);

      useEffect(() => { chatEndRef.current?.scrollIntoView({ behavior: 'smooth' }); }, [liveCommentary]);

      const commentary = liveCommentary;
      const awayScore = commentary?.score ? Object.values(commentary.score)[0] : game?.away?.score || 0;
      const homeScore = commentary?.score ? Object.values(commentary.score)[1] : game?.home?.score || 0;
      const mood = commentary?.play?.mood;
      const moodInfo = mood && moodColors[mood] ? moodColors[mood] : null;

      return (
        <div className="stream-overlay" onClick={onClose}>
          <div className="stream-scanline" />
          <div className="stream-hud">
            <div className="stream-hud-top">
              <div className="stream-hud-scores">
                <div className="stream-hud-team stream-hud-team-away">
                  <span className="stream-hud-abbr" style={{ color: awayColor }}>{awayAbbr}</span>
                  <span className="stream-hud-pts">{awayScore}</span>
                </div>
                <span className="stream-hud-sep">:</span>
                <div className="stream-hud-team stream-hud-team-home">
                  <span className="stream-hud-pts">{homeScore}</span>
                  <span className="stream-hud-abbr" style={{ color: homeColor }}>{homeAbbr}</span>
                </div>
              </div>
              <div className="stream-hud-info">
                {commentary?.play && <span className="stream-hud-clock">Q{commentary.play.quarter} {commentary.play.clock}</span>}
                {isLive && <div className="stream-hud-live"><div className="stream-hud-live-dot" />LIVE</div>}
                <span className="stream-hud-hint">tap to exit</span>
              </div>
            </div>
            {commentary?.play && (
              <div key={playKey} className={`stream-play-ticker ${playKey > 0 ? 'fresh' : ''}`} onClick={(e) => e.stopPropagation()}>
                <div className="stream-ticker-top">
                  <div className="stream-ticker-dot" />
                  <span className="stream-ticker-label">Latest Play</span>
                  <span className="stream-ticker-type">{commentary.play.playType} / {commentary.play.result}</span>
                  {moodInfo && <span className="stream-ticker-mood" style={{ background: moodInfo.bg, color: moodInfo.color }}>{moodInfo.label}</span>}
                </div>
                <div className="stream-ticker-desc">{commentary.play.description}</div>
              </div>
            )}
          </div>
          <div className="stream-chat" style={{ '--stream-color-a': awayColor, '--stream-color-b': homeColor }}>
            {commentary?.turns?.map((turn, i) => (
              <div key={`${commentary.timestamp}-${i}`} className={`stream-bubble ${turn.speaker === 'A' ? 'stream-bubble-a' : 'stream-bubble-b'}`} style={{ animationDelay: `${i * 0.2}s` }}>
                <div className="stream-speaker" style={{ color: turn.speaker === 'A' ? awayColor : homeColor }}>{turn.name}</div>
                <div className="stream-text">{turn.text}</div>
              </div>
            ))}
            {(!commentary?.turns || commentary.turns.length === 0) && (
              <div style={{ textAlign: 'center', padding: '40px 0', color: 'rgba(255,255,255,0.2)', fontSize: '14px' }}>Waiting for commentary...</div>
            )}
            <div className="stream-powered">sushi x modal ai</div>
            <div ref={chatEndRef} />
          </div>
        </div>
      );
    }

    // ─── COMMENTARY TAB ───
    function CommentaryTab({ game, sessionId, commentators: sessionCommentators }) {
      const [commentary, setCommentary] = useState(null);
      const [history, setHistory] = useState([]);
      const [loading, setLoading] = useState(false);
      const [autoRefresh, setAutoRefresh] = useState(true);
      const [streamMode, setStreamMode] = useState(false);
      const pollRef = useRef(null);
      const isLive = game?.status?.state === 'in';

      const awayColor = game?.away?.color || '#ff6b35';
      const homeColor = game?.home?.color || '#4a90d9';
      const awayAbbr = game?.away?.abbreviation || 'AWY';
      const homeAbbr = game?.home?.abbreviation || 'HME';

      const apiBase = sessionId ? `/api/sessions/${sessionId}` : '/api';

      const fetchCommentary = useCallback(async () => {
        try {
          setLoading(true);
          const res = await fetch(`${apiBase}/commentary/latest`);
          const data = await res.json();
          if (data.turns?.length > 0) setCommentary(data);
        } catch (err) {} finally { setLoading(false); }
      }, [apiBase]);

      const fetchHistory = useCallback(async () => {
        try {
          const res = await fetch(`${apiBase}/commentary/history`);
          const data = await res.json();
          if (Array.isArray(data)) setHistory(data);
        } catch (err) {}
      }, [apiBase]);

      useEffect(() => { fetchCommentary(); fetchHistory(); }, []);

      useEffect(() => {
        if (!autoRefresh) { clearInterval(pollRef.current); return; }
        const interval = isLive ? 12000 : 45000;
        pollRef.current = setInterval(() => { fetchCommentary(); fetchHistory(); }, interval);
        return () => clearInterval(pollRef.current);
      }, [autoRefresh, isLive, fetchCommentary, fetchHistory]);

      const moodLabels = {
        electric: { label: 'ELECTRIC', color: 'text-yellow-400', bg: 'bg-yellow-400/20' },
        disaster: { label: 'DISASTER', color: 'text-red-400', bg: 'bg-red-400/20' },
        momentum_shift: { label: 'MOMENTUM', color: 'text-purple-400', bg: 'bg-purple-400/20' },
        big_play: { label: 'BIG PLAY', color: 'text-green-400', bg: 'bg-green-400/20' },
        defensive_dominance: { label: 'D-WALL', color: 'text-blue-400', bg: 'bg-blue-400/20' },
        controversial: { label: 'FLAG?!', color: 'text-orange-400', bg: 'bg-orange-400/20' },
        stuffed: { label: 'STUFFED', color: 'text-gray-400', bg: 'bg-gray-400/20' },
        routine: { label: 'ROUTINE', color: 'text-gray-500', bg: 'bg-gray-500/20' },
      };

      // Use dynamic commentator names from session or commentary response
      const commentatorA = commentary?.commentators?.a || sessionCommentators?.find(c => c.id === 'A') || { name: 'Commentator A' };
      const commentatorB = commentary?.commentators?.b || sessionCommentators?.find(c => c.id === 'B') || { name: 'Commentator B' };

      function renderTurn(turn, i, mood) {
        const isA = turn.speaker === 'A';
        const color = isA ? awayColor : homeColor;
        const isElectric = mood === 'electric';
        return (
          <div key={i} className={`bubble-in ${isElectric && i === 0 ? 'mood-electric' : ''} rounded-xl p-3.5 bg-white/[0.03] ${isA ? 'bubble-a' : 'bubble-b'}`}
            style={{ '--color-a': awayColor, '--color-b': homeColor, animationDelay: `${i * 0.15}s` }}>
            <div className="flex items-center gap-2 mb-1.5">
              <div className="w-6 h-6 rounded-full flex items-center justify-center text-[10px] font-black" style={{ background: `${color}33`, color }}>
                {(turn.name || '')[0] || (isA ? 'A' : 'B')}
              </div>
              <div>
                <span className="text-xs font-bold" style={{ color }}>{turn.name}</span>
                <span className="text-[9px] text-gray-600 ml-1.5">({isA ? awayAbbr : homeAbbr} fan)</span>
              </div>
            </div>
            <p className="text-sm text-gray-200 leading-relaxed">{turn.text}</p>
            {turn.confidence != null && (
              <div className="mt-2.5 pt-2 border-t border-white/5">
                <div className="flex items-center gap-2 mb-1">
                  <Gauge size={11} className="text-gray-500" />
                  <span className="text-[10px] text-gray-500 uppercase tracking-wider">Prediction Confidence</span>
                  <span className="text-[10px] font-bold text-yellow-400 ml-auto">{(turn.confidence * 100).toFixed(0)}%</span>
                </div>
                <div className="h-1.5 rounded-full bg-white/5 overflow-hidden">
                  <div className="confidence-bar h-full rounded-full bg-gradient-to-r from-yellow-400 to-orange-500" style={{ width: `${turn.confidence * 100}%` }}></div>
                </div>
                {turn.prediction && (
                  <div className="text-[10px] text-gray-500 mt-1">Next play call: <span className="text-white font-medium uppercase">{turn.prediction}</span></div>
                )}
              </div>
            )}
          </div>
        );
      }

      if (!commentary && !loading) {
        return (
          <div className="space-y-4 animate-slide-up">
            <div className="glass rounded-xl p-8 text-center">
              <div className="flex justify-center mb-3 text-gray-600"><Mic size={32} /></div>
              <div className="text-sm text-gray-400">AI Commentary Engine</div>
              <div className="text-xs text-gray-600 mt-1">Unhinged commentators will argue about every play</div>
              <button onClick={fetchCommentary} className="mt-4 px-4 py-2 rounded-lg bg-yellow-400/20 text-yellow-400 text-xs font-bold hover:bg-yellow-400/30 transition-colors">
                Generate Commentary
              </button>
            </div>
          </div>
        );
      }

      return (
        <div className="space-y-4 animate-slide-up">
          <div className="flex items-center justify-between">
            <div className="flex items-center gap-2">
              <Mic size={14} className="text-yellow-400" />
              <h3 className="text-xs font-bold text-gray-400 uppercase tracking-wider">AI Duel Commentary</h3>
            </div>
            <div className="flex items-center gap-2">
              {commentary?.status === 'live' && (
                <span className="flex items-center gap-1 text-[9px] bg-red-500/20 text-red-400 px-2 py-0.5 rounded-full">
                  <span className="live-dot w-1.5 h-1.5 rounded-full bg-red-500 inline-block"></span>LIVE
                </span>
              )}
              {commentary?.status === 'pre' && <span className="text-[9px] bg-blue-500/20 text-blue-400 px-2 py-0.5 rounded-full">PRE-GAME</span>}
              <button onClick={() => setAutoRefresh(!autoRefresh)} className={`text-[9px] px-2 py-0.5 rounded-full transition-colors ${autoRefresh ? 'bg-green-500/20 text-green-400' : 'bg-white/5 text-gray-600'}`}>
                {autoRefresh ? 'AUTO' : 'PAUSED'}
              </button>
              <button onClick={fetchCommentary} className="text-gray-600 hover:text-gray-400 transition-colors">
                <RefreshCw size={13} className={loading ? 'animate-spin' : ''} />
              </button>
              <button onClick={() => setStreamMode(true)} className="flex items-center gap-1 text-[9px] px-2 py-0.5 rounded-full bg-red-500/20 text-red-400 hover:bg-red-500/30 transition-colors font-bold">
                <Maximize2 size={10} /> STREAM
              </button>
              <a href={`/avatar.html?session=${sessionId}`} className="flex items-center gap-1 text-[9px] px-2 py-0.5 rounded-full bg-purple-500/20 text-purple-400 hover:bg-purple-500/30 transition-colors font-bold">
                <Mic size={10} /> AVATAR
              </a>
            </div>
          </div>
          {streamMode && <StreamOverlay commentary={commentary} game={game} onClose={() => setStreamMode(false)} sessionId={sessionId} commentators={sessionCommentators} />}
          {commentary?.play && (
            <div className="glass rounded-xl p-3">
              <div className="flex items-center gap-2 flex-wrap">
                <span className="text-[10px] font-bold text-yellow-400">Q{commentary.play.quarter} {commentary.play.clock}</span>
                {commentary.play.mood && moodLabels[commentary.play.mood] && (
                  <span className={`text-[9px] px-1.5 py-0.5 rounded-full font-bold ${moodLabels[commentary.play.mood].bg} ${moodLabels[commentary.play.mood].color}`}>
                    {moodLabels[commentary.play.mood].label}
                  </span>
                )}
                <span className="text-[9px] bg-white/5 text-gray-500 px-1.5 py-0.5 rounded-full">{commentary.play.playType} / {commentary.play.result}</span>
              </div>
              <p className="text-xs text-gray-400 mt-1.5 leading-relaxed">{commentary.play.description}</p>
            </div>
          )}
          {commentary?.score && (
            <div className="flex items-center justify-center gap-4 py-1">
              <div className="flex items-center gap-1.5">
                <span className="text-xs font-bold" style={{ color: awayColor }}>{awayAbbr}</span>
                <span className="text-lg font-black">{Object.values(commentary.score)[0]}</span>
              </div>
              <span className="text-gray-600 text-sm">-</span>
              <div className="flex items-center gap-1.5">
                <span className="text-lg font-black">{Object.values(commentary.score)[1]}</span>
                <span className="text-xs font-bold" style={{ color: homeColor }}>{homeAbbr}</span>
              </div>
            </div>
          )}
          {loading && !commentary && (
            <div className="glass rounded-xl p-6 text-center">
              <Loader2 size={24} className="animate-spin text-yellow-400 mx-auto mb-2" />
              <div className="text-xs text-gray-500">{commentatorA.name} and {commentatorB.name} are warming up...</div>
            </div>
          )}
          {commentary?.turns?.length > 0 && (
            <div className="space-y-2.5">{commentary.turns.map((turn, i) => renderTurn(turn, i, commentary?.play?.mood))}</div>
          )}
          {history.length > 1 && (
            <div className="pt-2">
              <div className="flex items-center gap-2 mb-3">
                <Clock size={12} className="text-gray-600" />
                <span className="text-[10px] text-gray-600 uppercase tracking-wider font-bold">Previous Reactions</span>
              </div>
              <div className="space-y-3">
                {history.slice(1, 6).map((entry, hi) => (
                  <div key={hi} className="glass rounded-xl p-3 opacity-60 hover:opacity-100 transition-opacity">
                    {entry.play && (
                      <div className="text-[9px] text-gray-600 mb-2">
                        Q{entry.play.quarter} {entry.play.clock} — {entry.play.playType}: {entry.play.description?.slice(0, 80)}{entry.play.description?.length > 80 ? '...' : ''}
                      </div>
                    )}
                    <div className="space-y-1.5">
                      {entry.turns?.map((turn, ti) => (
                        <div key={ti} className={`text-[11px] p-2 rounded-lg bg-white/[0.02] ${turn.speaker === 'A' ? 'bubble-a' : 'bubble-b'}`}
                          style={{ '--color-a': awayColor, '--color-b': homeColor }}>
                          <span className="font-bold text-[10px]" style={{ color: turn.speaker === 'A' ? awayColor : homeColor }}>{turn.name}: </span>
                          <span className="text-gray-400">{turn.text?.slice(0, 120)}{turn.text?.length > 120 ? '...' : ''}</span>
                        </div>
                      ))}
                    </div>
                  </div>
                ))}
              </div>
            </div>
          )}
          <div className="text-center py-2 flex items-center justify-center gap-1 text-gray-700">
            <Flame size={10} /><span className="text-[9px]">Powered by Modal AI</span>
          </div>
        </div>
      );
    }

    // ─── NEWS TAB ───
    function NewsTab({ news }) {
      if (!news?.length) {
        return (
          <div className="glass rounded-xl p-8 text-center animate-slide-up">
            <div className="flex justify-center mb-3 text-gray-600"><Newspaper size={32} /></div>
            <div className="text-sm text-gray-400">Loading latest news...</div>
          </div>
        );
      }
      return (
        <div className="space-y-3 animate-slide-up">
          {news.map((article, i) => (
            <a key={i} href={article.link} target="_blank" rel="noopener noreferrer" className="glass-bright rounded-xl p-4 block card-hover">
              <div className="flex gap-3">
                {article.image && <img src={article.image} className="w-20 h-14 rounded-lg object-cover flex-shrink-0 bg-white/5" onError={(e) => e.target.style.display='none'} />}
                <div className="flex-1 min-w-0">
                  <h3 className="text-sm font-bold text-white leading-snug mb-1 line-clamp-2">{article.headline}</h3>
                  <p className="text-[10px] text-gray-500 line-clamp-2">{article.description}</p>
                  {article.published && (
                    <div className="text-[9px] text-gray-600 mt-1.5 flex items-center gap-1">
                      <Clock size={9} />
                      {new Date(article.published).toLocaleDateString('en-US', { month: 'short', day: 'numeric', hour: 'numeric', minute: '2-digit' })}
                    </div>
                  )}
                </div>
                <div className="flex-shrink-0 self-center text-gray-600"><ExternalLink size={14} /></div>
              </div>
            </a>
          ))}
          <div className="text-center py-2 flex items-center justify-center gap-1 text-gray-600">
            <Radio size={10} /><span className="text-[9px]">Powered by ESPN</span>
          </div>
        </div>
      );
    }

    // ─── SESSION VIEW (full tracker for one session) ───
    function SessionView({ sessionId }) {
      const [activeTab, setActiveTab] = useState('scores');
      const [game, setGame] = useState(null);
      const [summary, setSummary] = useState(null);
      const [news, setNews] = useState(null);
      const [sessionMeta, setSessionMeta] = useState(null);
      const [loading, setLoading] = useState(true);
      const [error, setError] = useState(null);
      const [lastUpdate, setLastUpdate] = useState(null);
      const pollRef = useRef(null);

      const apiBase = sessionId ? `/api/sessions/${sessionId}` : '/api';

      const fetchAll = useCallback(async () => {
        try {
          const urls = sessionId
            ? [`${apiBase}/game`, `${apiBase}/summary`, `${apiBase}/news`]
            : ['/api/game', '/api/summary', '/api/news'];

          const [gameRes, summaryRes, newsRes] = await Promise.all([
            fetch(urls[0]).then(r => r.json()),
            fetch(urls[1]).then(r => r.json()).catch(() => null),
            fetch(urls[2]).then(r => r.json()).catch(() => []),
          ]);
          setGame(gameRes);
          if (summaryRes) setSummary(summaryRes);
          if (newsRes?.length) setNews(newsRes);
          setLastUpdate(new Date());
          setLoading(false);
          setError(null);
        } catch (err) {
          setError(err.message);
          setLoading(false);
        }
      }, [sessionId, apiBase]);

      // Fetch session metadata
      useEffect(() => {
        if (sessionId) {
          fetch('/api/sessions').then(r => r.json()).then(sessions => {
            const s = sessions.find(s => s.id === sessionId);
            if (s) setSessionMeta(s);
          }).catch(() => {});
        }
      }, [sessionId]);

      useEffect(() => {
        fetchAll();
        const interval = game?.status?.state === 'in' ? 10000 : 30000;
        pollRef.current = setInterval(fetchAll, interval);
        return () => clearInterval(pollRef.current);
      }, [fetchAll, game?.status?.state]);

      const sport = sessionMeta?.sport || 'football';
      const visibleTabs = getVisibleTabs(sport);

      if (loading) {
        return (
          <div className="min-h-screen flex items-center justify-center">
            <div className="text-center">
              <Loader2 size={40} className="animate-spin text-yellow-400 mx-auto mb-4" />
              <div className="text-lg font-bold text-gradient mb-2">SUSHI</div>
              <div className="text-sm text-gray-500">Connecting to ESPN...</div>
            </div>
          </div>
        );
      }

      const isLive = game?.status?.state === 'in';

      return (
        <div className="min-h-screen pb-20">
          <header className="sticky top-0 z-50 bg-dark-900/80 backdrop-blur-xl border-b border-white/5">
            <div className="max-w-lg mx-auto px-4 py-3 flex items-center justify-between">
              <div className="flex items-center gap-2.5">
                <button onClick={() => navigate('#/')} className="text-gray-400 hover:text-white transition-colors mr-1">
                  <ArrowLeft size={18} />
                </button>
                <div className="text-xl">{SPORT_ICONS[sport] || '\uD83C\uDFC6'}</div>
                <div>
                  <h1 className="text-sm font-black tracking-tight text-gradient">SUSHI</h1>
                  <p className="text-[10px] text-gray-500 -mt-0.5">
                    {sessionMeta?.gameName || game?.name || 'Live Sports'}
                  </p>
                </div>
              </div>
              <div className="flex items-center gap-2">
                {isLive && (
                  <span className="flex items-center gap-1.5 text-xs bg-red-500/20 text-red-400 px-2.5 py-1 rounded-full">
                    <span className="live-dot w-1.5 h-1.5 rounded-full bg-red-500 inline-block"></span>LIVE
                  </span>
                )}
                {lastUpdate && !error && (
                  <span className="text-[9px] text-gray-600 flex items-center gap-1">
                    <RefreshCw size={9} />{lastUpdate.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}
                  </span>
                )}
              </div>
            </div>
          </header>

          <main className="max-w-lg mx-auto px-4 py-4">
            {activeTab === 'scores' && <ScoresTab game={game} summary={summary} sport={sport} />}
            {activeTab === 'commentary' && <CommentaryTab game={game} sessionId={sessionId} commentators={sessionMeta?.commentators} />}
            {activeTab === 'stats' && <StatsTab summary={summary} game={game} />}
            {activeTab === 'plays' && <PlaysTab summary={summary} game={game} />}
            {activeTab === 'odds' && <OddsTab summary={summary} game={game} />}
            {activeTab === 'news' && <NewsTab news={news} />}
          </main>

          <nav className="fixed bottom-0 left-0 right-0 z-50 bg-dark-900/90 backdrop-blur-xl border-t border-white/5">
            <div className="max-w-lg mx-auto flex">
              {visibleTabs.map(tab => {
                const TabIcon = tab.Icon;
                const active = activeTab === tab.id;
                return (
                  <button key={tab.id} onClick={() => setActiveTab(tab.id)}
                    className={`flex-1 flex flex-col items-center py-2.5 transition-all ${active ? 'text-yellow-400' : 'text-gray-600 hover:text-gray-400'}`}>
                    <TabIcon size={20} />
                    <span className="text-[10px] mt-0.5 font-medium">{tab.label}</span>
                    {active && <div className="w-1 h-1 rounded-full bg-yellow-400 mt-0.5"></div>}
                  </button>
                );
              })}
            </div>
          </nav>
        </div>
      );
    }

    // ─── LANDING PAGE ───
    function LandingPage() {
      const [sessions, setSessions] = useState([]);
      const [loading, setLoading] = useState(true);

      useEffect(() => {
        fetch('/api/sessions')
          .then(r => r.json())
          .then(data => { setSessions(Array.isArray(data) ? data : []); setLoading(false); })
          .catch(() => setLoading(false));

        const interval = setInterval(() => {
          fetch('/api/sessions').then(r => r.json()).then(data => {
            if (Array.isArray(data)) setSessions(data);
          }).catch(() => {});
        }, 30000);
        return () => clearInterval(interval);
      }, []);

      if (loading) {
        return (
          <div className="min-h-screen flex items-center justify-center">
            <div className="text-center">
              <Loader2 size={40} className="animate-spin text-yellow-400 mx-auto mb-4" />
              <div className="text-lg font-bold text-gradient mb-2">SUSHI</div>
              <div className="text-sm text-gray-500">Loading sessions...</div>
            </div>
          </div>
        );
      }

      return (
        <div className="min-h-screen">
          <header className="sticky top-0 z-50 bg-dark-900/80 backdrop-blur-xl border-b border-white/5">
            <div className="max-w-2xl mx-auto px-4 py-4 flex items-center justify-between">
              <div className="flex items-center gap-3">
                <Trophy size={24} className="text-yellow-400" />
                <div>
                  <h1 className="text-lg font-black tracking-tight text-gradient">SUSHI</h1>
                  <p className="text-[10px] text-gray-500 -mt-0.5">Live Sports Commentary</p>
                </div>
              </div>
            </div>
          </header>

          <main className="max-w-2xl mx-auto px-4 py-6">
            {sessions.length === 0 ? (
              <div className="glass rounded-2xl p-12 text-center animate-fade-in">
                <div className="text-4xl mb-4">{'\uD83C\uDFC6'}</div>
                <div className="text-lg font-bold text-white mb-2">No Live Games Right Now</div>
                <div className="text-sm text-gray-500 mb-2">There are no games set up at this time.</div>
                <div className="text-sm text-gray-600">Check back soon — new games get added regularly!</div>
              </div>
            ) : (
              <div className="grid gap-4 sm:grid-cols-2">
                {sessions.map(session => {
                  const sportIcon = SPORT_ICONS[session.sport] || '\uD83C\uDFC6';
                  const homeColor = session.homeTeam?.color || '#333';
                  const awayColor = session.awayTeam?.color || '#333';
                  const isActive = session.status === 'active';

                  return (
                    <button key={session.id} onClick={() => navigate(`#/session/${session.id}`)}
                      className="glass-bright rounded-2xl overflow-hidden text-left card-hover animate-fade-in w-full">
                      <div className="p-4">
                        <div className="flex items-center justify-between mb-3">
                          <div className="flex items-center gap-2">
                            <span className="text-xl">{sportIcon}</span>
                            <span className="text-[10px] font-bold text-gray-500 uppercase tracking-wider">{session.league?.toUpperCase()}</span>
                          </div>
                          <span className={`text-[9px] px-2 py-0.5 rounded-full font-bold ${isActive ? 'bg-green-500/20 text-green-400' : 'bg-yellow-500/20 text-yellow-400'}`}>
                            {session.status?.toUpperCase()}
                          </span>
                        </div>

                        <div className="flex items-center justify-between gap-3">
                          <div className="flex items-center gap-2 flex-1 min-w-0">
                            {session.awayTeam?.logo && <img src={session.awayTeam.logo} className="w-8 h-8 object-contain" onError={e => e.target.style.display='none'} />}
                            <span className="text-sm font-bold truncate" style={{color: awayColor}}>{session.awayTeam?.abbreviation || 'AWY'}</span>
                          </div>
                          <span className="text-xs text-gray-600 font-medium">vs</span>
                          <div className="flex items-center gap-2 flex-1 min-w-0 justify-end">
                            <span className="text-sm font-bold truncate" style={{color: homeColor}}>{session.homeTeam?.abbreviation || 'HME'}</span>
                            {session.homeTeam?.logo && <img src={session.homeTeam.logo} className="w-8 h-8 object-contain" onError={e => e.target.style.display='none'} />}
                          </div>
                        </div>

                        {session.gameName && (
                          <div className="text-[10px] text-gray-500 mt-2 text-center truncate">{session.gameName}</div>
                        )}

                        {session.commentators?.length > 0 && (
                          <div className="flex items-center justify-center gap-2 mt-2">
                            {session.commentators.map(c => (
                              <span key={c.id} className="text-[9px] bg-white/5 text-gray-500 px-1.5 py-0.5 rounded-full">{c.name}</span>
                            ))}
                          </div>
                        )}
                      </div>

                      <div className="flex border-t border-white/5">
                        <div className="flex-1 py-1.5 text-center" style={{background: `${awayColor}44`}}>
                          <span className="text-[10px] font-bold text-white/80">{session.awayTeam?.name || 'Away'}</span>
                        </div>
                        <div className="flex-1 py-1.5 text-center" style={{background: `${homeColor}44`}}>
                          <span className="text-[10px] font-bold text-white/80">{session.homeTeam?.name || 'Home'}</span>
                        </div>
                      </div>
                    </button>
                  );
                })}
              </div>
            )}
          </main>
        </div>
      );
    }

    // ─── MAIN APP WITH HASH ROUTING ───
    function App() {
      const route = useHashRoute();

      // Parse route
      const sessionMatch = route.match(/^#\/session\/(.+)$/);

      if (sessionMatch) {
        return <SessionView sessionId={sessionMatch[1]} />;
      }

      // Default / no sessions: if hash is empty or #/, check for sessions
      // If no sessions exist and no hash routing, fall back to legacy single-game view
      if (route === '#/' || route === '' || route === '#') {
        return <LandingPage />;
      }

      // Fallback
      return <LandingPage />;
    }

    ReactDOM.createRoot(document.getElementById('root')).render(<App />);
  </script>
</body>
</html>
